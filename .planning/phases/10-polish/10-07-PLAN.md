---
phase: 10-polish
plan: 07
type: execute
wave: 2
depends_on: []
files_modified:
  - app/components/Taskbar.tsx
  - app/components/Window.tsx
autonomous: true

must_haves:
  truths:
    - "Taskbar clock updates every second in real-time"
    - "Minimized windows can flash taskbar button for attention"
    - "Double-clicking window title bar maximizes/restores"
  artifacts:
    - path: "app/components/Taskbar.tsx"
      provides: "Real-time clock component"
      min_lines: 80
    - path: "app/components/Window.tsx"
      provides: "Double-click maximize handler"
      min_lines: 50
  key_links:
    - from: "app/components/Taskbar.tsx"
      to: "Date API"
      via: "setInterval clock updates"
      pattern: "setInterval.*1000"
    - from: "app/components/Window.tsx"
      to: "window maximize"
      via: "onDoubleClick handler"
      pattern: "onDoubleClick.*maximize"
---

<objective>
Enhance taskbar with real-time clock and button flash, add double-click maximize to windows.

Purpose: Add final polish touches to taskbar and window interactions
Output: Working real-time clock, taskbar button flash, and double-click maximize
</objective>

<execution_context>
@/Users/lucas/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/lucas/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-polish/10-CONTEXT.md
@.planning/phases/10-polish/10-RESEARCH.md
@app/components/Taskbar.tsx
@app/components/Window.tsx
</context>

<tasks>

<task type="auto">
  <name>Add real-time clock to Taskbar</name>
  <files>app/components/Taskbar.tsx</files>
  <action>
Update Taskbar component to show live-updating clock:

1. **Find the clock section** (likely has static time display)

2. **Create Clock component** (can be inline or separate):
```typescript
function Clock() {
  const [time, setTime] = useState(new Date());
  
  useEffect(() => {
    const interval = setInterval(() => {
      setTime(new Date());
    }, 1000); // Update every second
    
    return () => clearInterval(interval);
  }, []);
  
  const formattedTime = time.toLocaleTimeString('en-US', { 
    hour: 'numeric', 
    minute: '2-digit',
    hour12: true 
  });
  
  return (
    <div className="taskbar-clock">
      {formattedTime}
    </div>
  );
}
```

3. **Replace static time** with Clock component:
```tsx
{/* Old: <div className="clock">12:00 PM</div> */}
<Clock />
```

4. **Add CSS styling** if needed (likely already styled):
```css
.taskbar-clock {
  padding: 0 8px;
  border: 2px inset;
  border-color: var(--button-shadow) var(--button-highlight) var(--button-highlight) var(--button-shadow);
  font-family: "Tahoma", sans-serif;
  font-size: 11px;
  min-width: 60px;
  text-align: center;
}
```

5. **Optimize rendering**: Wrap Clock component in `React.memo()` to prevent unnecessary parent re-renders.

**Performance note**: 1s interval for clock is standard and won't cause performance issues. Do NOT update more frequently (e.g., every 100ms for seconds counter) as this would cause excessive re-renders.
  </action>
  <verify>
1. Run: `npm run dev`
2. Open http://localhost:3000
3. Watch taskbar clock:
   - Should display current time in "12:34 PM" format
   - Should update every second (watch the minute change)
   - Should not cause UI jank or performance issues
4. Open multiple windows and verify clock still updates smoothly
  </verify>
  <done>
Taskbar displays real-time clock that updates every second. Time format is "12:34 PM" (12-hour with AM/PM). Clock updates visible as minutes change. No performance degradation.
  </done>
</task>

<task type="auto">
  <name>Add taskbar button flash functionality</name>
  <files>
app/components/Taskbar.tsx
app/contexts/WindowManagerContext.tsx
app/globals.css
  </files>
  <action>
Add taskbar button flash effect for minimized windows needing attention:

**In WindowManagerContext.tsx:**

1. **Add flash state** to window objects (or separate state):
```typescript
// In window type definition:
interface Window {
  // ... existing properties
  isFlashing?: boolean;
}

// Add function:
const flashTaskbarButton = useCallback((windowId: string) => {
  setWindows(prev => 
    prev.map(w => 
      w.id === windowId 
        ? { ...w, isFlashing: true } 
        : w
    )
  );
}, []);

// Clear flash when window is focused:
const focusWindow = useCallback((windowId: string) => {
  // ... existing focus logic
  setWindows(prev => 
    prev.map(w => 
      w.id === windowId 
        ? { ...w, isFlashing: false, /* ... */ } 
        : w
    )
  );
}, []);

// Add to context value:
value={{ /* ... */, flashTaskbarButton }}
```

**In Taskbar.tsx:**

2. **Apply flashing class** to taskbar buttons:
```tsx
{windows.map(window => (
  <button
    key={window.id}
    className={`taskbar-button ${window.isFlashing ? 'flashing' : ''}`}
    onClick={() => restoreWindow(window.id)}
  >
    {window.title}
  </button>
))}
```

**In globals.css:**

3. **Add flash animation**:
```css
@keyframes taskbarButtonFlash {
  0%, 100% { background: var(--button-face); }
  50% { background: #ffa500; } /* Orange */
}

.taskbar-button.flashing {
  animation: taskbarButtonFlash 0.5s ease-in-out infinite;
}
```

**Usage example** (optional, for demonstration):
```typescript
// In a component like Minesweeper or ChatRoom:
const { flashTaskbarButton } = useWindowManager();

// When minimized and notification occurs:
if (windowState === 'minimized') {
  flashTaskbarButton(windowId);
}
```

**Note**: The flash mechanism is in place. Individual apps can use it when needed (e.g., new chat message while minimized).
  </action>
  <verify>
1. Run: `npx tsc --noEmit` - check no TypeScript errors
2. Run: `npm run dev`
3. Test flash functionality (manual test via browser console):
```javascript
// In console, find windowManager and call:
// windowManager.flashTaskbarButton('some-window-id')
```
4. Verify taskbar button alternates between normal and orange
5. Click button to restore window - flash should stop
6. Check animation is smooth (0.5s cycle)
  </verify>
  <done>
WindowManagerContext has flashTaskbarButton function. Taskbar buttons show flashing animation when isFlashing is true. Flash stops when window is focused. Animation is smooth orange pulse.
  </done>
</task>

<task type="auto">
  <name>Add double-click maximize to Window title bar</name>
  <files>app/components/Window.tsx</files>
  <action>
Add double-click handler to window title bar for maximize/restore:

1. **Add double-click handler** to title bar div:
```typescript
const handleTitleBarDoubleClick = () => {
  if (windowState === 'maximized') {
    windowManager.restoreWindow(id);
  } else if (windowState === 'normal') {
    windowManager.maximizeWindow(id);
  }
  // If minimized, do nothing (not possible to double-click minimized window)
};
```

2. **Apply to title bar JSX**:
```tsx
<div 
  className="window-title-bar"
  onDoubleClick={handleTitleBarDoubleClick}
  // ... existing props (drag handle, etc.)
>
  <span className="window-title">{title}</span>
  {/* ... buttons */}
</div>
```

3. **Ensure react-rnd drag doesn't interfere**: The onDoubleClick event should fire before drag starts. Test that double-clicking doesn't trigger a drag.

4. **Prevent double-click text selection**: Add CSS to title bar if needed:
```css
.window-title-bar {
  user-select: none; /* Prevent text selection on double-click */
}
```

5. **Handle edge case**: If title bar is already a drag handle, ensure double-click is detected before drag initiates. react-rnd should handle this correctly, but verify.
  </action>
  <verify>
1. Run: `npm run dev`
2. Open http://localhost:3000
3. Open any window
4. Test double-click maximize:
   - **Double-click title bar**: Window should maximize to fullscreen
   - **Double-click title bar again**: Window should restore to previous size/position
   - **Rapid double-clicks**: Should toggle maximize/restore smoothly
5. Verify single-click still allows dragging (no interference)
6. Verify no text selection on title bar when double-clicking
  </verify>
  <done>
Window title bar responds to double-click by toggling maximize/restore. Double-clicking maximized window restores it. No interference with drag functionality. No text selection on double-click.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Taskbar enhancements (real-time clock, button flash) and window double-click maximize</what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open http://localhost:3000
3. Test real-time clock:
   - **Check taskbar**: Should show current time (e.g., "3:45 PM")
   - **Wait for minute change**: Time should update automatically
   - **Open multiple windows**: Clock should still update smoothly
4. Test double-click maximize:
   - **Open any window** (Notepad, Paint, etc.)
   - **Double-click window title bar**: Should maximize to fullscreen
   - **Double-click title bar again**: Should restore to previous size
   - **Test on multiple windows**: Should work consistently
   - **Verify single-click drag**: Should still work (no interference)
5. Test taskbar button flash (optional - requires code setup):
   - If flash is implemented for any app (e.g., Minesweeper notification)
   - Minimize the window and trigger the notification
   - Taskbar button should pulse orange
   - Click button to restore - pulse should stop
6. Expected behavior:
   - Clock updates every second with no jank
   - Double-click maximize feels natural and responsive
   - Flash animation (if tested) is smooth and attention-grabbing
   - No interference between features
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Taskbar clock updates every second in real-time
- [ ] Clock format is "12:34 PM" (12-hour with AM/PM)
- [ ] Clock updates don't cause performance issues
- [ ] Taskbar button flash animation implemented
- [ ] flashTaskbarButton function available in WindowManagerContext
- [ ] Flash stops when window is focused
- [ ] Window title bar responds to double-click
- [ ] Double-click toggles maximize/restore
- [ ] Single-click drag still works (no interference)
- [ ] No TypeScript errors or console errors
</verification>

<success_criteria>
- Taskbar clock displays current time and updates every second
- Clock performance is smooth with no UI jank
- Taskbar buttons can flash orange for attention
- Flash animation is smooth (0.5s cycle)
- Window title bar double-click maximizes/restores
- Double-click feels natural and responsive
- No interference with existing drag functionality
- All features work consistently across multiple windows
- TypeScript strict mode passes
- User verification confirms polished, complete UX
</success_criteria>

<output>
After completion, create `.planning/phases/10-polish/10-07-SUMMARY.md`
</output>
